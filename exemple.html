<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Miroir.js - Exemple optimisé</title>
</head>
<body>
    <div id="app">
        <!-- Méthode classique avec templates HTML -->
        <div class="bind">
            <h1>Nom: {{ name }}</h1>
            <p>Age: {{ age }}</p>
        </div>
        
        <!-- Méthode classique avec d-model -->
        <input d-model="name" placeholder="Votre nom">
        <input d-model="age" type="number" placeholder="Votre âge">
        
        <!-- Éléments qui seront liés via JavaScript -->
        <div class="js-name"></div>
        <div id="js-age"></div>
        <input id="js-input" placeholder="Lié via JS">
    </div>

    <script src="miroir.js"></script>
    <script>
        // État initial
        const state = {
            name: 'John Doe',
            age: 25,
            message: 'Hello from JS binding!'
        };

        // Configuration avec les nouvelles options
        const app = miroir.create(state, {
            root: document.getElementById('app'),
            
            // Nouveaux bindings JavaScript (alternative aux templates HTML)
            bindings: [
                { '.js-name': 'name' },        // Classe CSS -> propriété
                { '#js-age': 'age' },          // ID -> propriété  
                { '#js-input': 'message' }     // Input lié via JS
            ]
        });

        // Watcher pour observer les changements
        miroir.watch('name', (newVal, oldVal) => {
            console.log(`Nom changé: ${oldVal} -> ${newVal}`);
        });

        // Test des performances avec mises à jour multiples
        setTimeout(() => {
            // Ces mises à jour seront batchées automatiquement
            state.name = 'Jane Smith';
            state.age = 30;
            state.message = 'Mis à jour en batch!';
        }, 2000);

        // Cleanup au besoin (optionnel)
        // app.destroy();
    </script>
</body>
</html>