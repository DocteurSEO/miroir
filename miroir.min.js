const miroir=(()=>{const e=/\{\{\s*(\w+)\s*\}\}/g,t=/\{\{\s*(\w+)\s*\}\}/g,n=new Map,r=new Map,o=new Map,s=new WeakMap;let c=new Set,a=!1;function i(i){c.forEach(c=>{const a=n.get(c);a&&a.forEach(n=>{"text"===n.type?n.el.originalHTML?l(n.el,i):n.el.textContent=i[c]??"":"model"===n.type&&(n.el.value=i[c])})})}function u(t,n,r){t.forEach(t=>{Object.entries(t).forEach(([t,o])=>{r.querySelectorAll(t).forEach(t=>{if(!n.has(o)){n.set(o,[])}let r=s.get(t);void 0===r&&(r="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName,s.set(t,r)),r?(t.value=i[o]||"",t.addEventListener("input",e=>{i[o]=e.target.value}),t._mitoirHandler=e=>{i[o]=e.target.value},n.get(o).push({type:"model",el:t})):(t.textContent=i[o]||"",n.get(o).push({type:"text",el:t}))})})})}function d(r,o,c){r.querySelectorAll(c.bindSelector).forEach(r=>{r.originalHTML=r.innerHTML,[...r.innerHTML.matchAll(e)].forEach(e=>{const t=e[1];n.has(t)||n.set(t,[]),n.get(t).push({type:"text",el:r})}),l(r,o)}),r.querySelectorAll(`[${c.modelAttribute}]`).forEach(e=>{const t=e.getAttribute(c.modelAttribute);e.value=o[t];const r=e=>o[t]=e.target.value;e.addEventListener("input",r),e._mitoirHandler=r,n.has(t)||n.set(t,[]),n.get(t).push({type:"model",el:e})})}function l(e,n){if(!e.originalHTML)return void(e.textContent=n[Object.keys(n)[0]]??"");let r=s.get(e);void 0===r&&(r=-1!==e.originalHTML.indexOf("<"),s.set(e,r)),t.lastIndex=0;const o=e.originalHTML.replace(t,(e,t)=>n[t]??"");r?e.innerHTML=o:e.textContent=o}function f(e,t){r.has(e)||r.set(e,[]),r.get(e).push(t)}function g(e,t){o.set(e,t)}function h(e,t){o.forEach((n,r)=>{e.querySelectorAll(`[${r}]`).forEach(e=>{const o=e.getAttribute(r);n(e,o,t)})})}function p(e){e.querySelectorAll("input, textarea, select").forEach(e=>{e.removeEventListener("input",e._mitoirHandler)}),n.clear(),r.clear(),c.clear(),a=!1}return{create:function(e,t={}){const n={root:t.root||document.body,bindSelector:t.bindSelector||".bind",modelAttribute:t.modelAttribute||"d-model",bindings:t.bindings||[]},r=new Proxy(e,{set(t,n,r){const o=t[n];return o===r||(t[n]=r,c.add(n),a||(a=!0,requestAnimationFrame(()=>{i(t),c.clear(),a=!1})),s.get(n)?.forEach(e=>e(r,o)),!0)}});return u(n.bindings,r,n.root),d(n.root,r,n),h(n.root,r),r.destroy=()=>p(n.root),r},watch:f,extend:g}})();