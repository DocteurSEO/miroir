/**
 * ðŸªž Miroir.js - Ultra-lightweight reactive data binding library
 * 
 * @description Provides simple, powerful, and fast two-way data binding with zero dependencies.
 * Choose between HTML templates or JavaScript bindings - both work seamlessly together.
 * 
 * @version 1.0.0
 * @author Miroir.js Team
 * @license MIT
 * 
 * @example
 * // Basic usage with HTML templates
 * const state = miroir.create({
 *   name: 'John',
 *   age: 25
 * });
 * 
 * @example
 * // Advanced usage with JavaScript bindings
 * const app = miroir.create(state, {
 *   bindings: [
 *     { '.title': 'name' },
 *     { '#counter': 'count' }
 *   ]
 * });
 */ const miroir=(()=>{let e=/\{\{\s*(\w+)\s*\}\}/g,t=/\{\{\s*(\w+)\s*\}\}/g,r=new Map,n=new Map,l=new Map,o=new WeakMap,i=new Set,a=!1;function u(e,t={}){let r={root:t.root||document.body,bindSelector:t.bindSelector||".bind",modelAttribute:t.modelAttribute||"d-model",bindings:t.bindings||[]},l=new Proxy(e,{set(e,t,r){let l=e[t];if(l===r)return!0;e[t]=r,i.add(t),a||(a=!0,requestAnimationFrame(()=>{c(e),i.clear(),a=!1}));let o=n.get(t);return o&&o.forEach(e=>e(r,l)),!0}});return d(r.bindings,l,r.root),s(r.root,l,r),E(r.root,l),l.destroy=()=>m(r.root),l}function c(e){i.forEach(t=>{let n=r.get(t);n&&n.forEach(r=>{"text"===r.type?r.el.originalHTML?f(r.el,e):r.el.textContent=e[t]??"":"model"===r.type&&(r.el.value=e[t])})})}function d(e,t,n){e.forEach(e=>{Object.entries(e).forEach(([e,l])=>{let i=n.querySelectorAll(e);i.forEach(e=>{r.has(l)||r.set(l,[]);let n=o.get(e);if(void 0===n){let i=e.tagName;n="INPUT"===i||"TEXTAREA"===i||"SELECT"===i,o.set(e,n)}if(n){e.value=t[l]||"";let a=e=>t[l]=e.target.value;e.addEventListener("input",a),e._mitoirHandler=a,r.get(l).push({type:"model",el:e})}else e.textContent=t[l]||"",r.get(l).push({type:"text",el:e})})})})}function s(t,n,l){t.querySelectorAll(l.bindSelector).forEach(t=>{t.originalHTML=t.innerHTML,[...t.innerHTML.matchAll(e)].forEach(e=>{let n=e[1];r.has(n)||r.set(n,[]),r.get(n).push({type:"text",el:t})}),f(t,n)}),t.querySelectorAll(`[${l.modelAttribute}]`).forEach(e=>{let t=e.getAttribute(l.modelAttribute);e.value=n[t];let o=e=>n[t]=e.target.value;e.addEventListener("input",o),e._mitoirHandler=o,r.has(t)||r.set(t,[]),r.get(t).push({type:"model",el:e})})}function f(e,r){if(!e.originalHTML){e.textContent=r[Object.keys(r)[0]]??"";return}let n=o.get(e);void 0===n&&(n=-1!==e.originalHTML.indexOf("<"),o.set(e,n)),t.lastIndex=0;let l=e.originalHTML.replace(t,(e,t)=>r[t]??"");n?e.innerHTML=l:e.textContent=l}function g(e,t){n.has(e)||n.set(e,[]),n.get(e).push(t)}function h(e,t){l.set(e,t)}function E(e,t){l.forEach((r,n)=>{e.querySelectorAll(`[${n}]`).forEach(e=>{let l=e.getAttribute(n);r(e,l,t)})})}function m(e){e.querySelectorAll("input, textarea, select").forEach(e=>{e._mitoirHandler&&(e.removeEventListener("input",e._mitoirHandler),delete e._mitoirHandler)}),r.clear(),n.clear(),i.clear(),a=!1}return{create:u,watch:g,extend:h}})();